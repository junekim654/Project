---
title: "Final Project"
author: "Taiga Hasegawa(taigah2)"
date: "2019/4/11"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
#FirstD1Season - the first season in our dataset that the school was a Division-I school
#LastD1Season - the last season in our dataset that the school was a Division-I school
teams=read.csv("DataFiles/Teams.csv")

#national semifinals are always on daynum=152, the "play-in" games are on days 134/135, Selection Sunday is on day 132
#Whichever region's name comes first alphabetically, that region will be Region W. And whichever Region plays against Region W in the national semifinals, that will be Region X. For the other two regions, whichever region's name comes first alphabetically, that region will be Region Y, and the other will be Region Z. 
Seasons=read.csv("DataFiles/Seasons.csv")

#the first character is either W, X, Y, or Z and the next two digits tells you the seed within the region. For play-in teams, there is a fourth character (a or b) to further distinguish the seeds
NCAATourneySeeds=read.csv("DataFiles/NCAATourneySeeds.csv")

#Regular Season games are simply defined to be all games played on DayNum=132 or earlier (DayNum=132 is Selection Sunday
#WLoc -If the winning team was the home team, this value will be "H". If the winning team was the visiting team, this value will be "A"
RegularSeasonCompactResults=read.csv("DataFiles/RegularSeasonCompactResults.csv")

#Because of the consistent structure of the NCAAÂ® tournament schedule, you can actually tell what round a game was, depending on the exact DayNum. Thus:
#DayNum=134 or 135 (Tue/Wed) - play-in games to get the tournament field down to the final 64 teams
#DayNum=136 or 137 (Thu/Fri) - Round 1, to bring the tournament field from 64 teams to 32 teams
#DayNum=138 or 139 (Sat/Sun) - Round 2, to bring the tournament field from 32 teams to 16 teams
#DayNum=143 or 144 (Thu/Fri) - Round 3, otherwise known as "Sweet Sixteen", to bring the tournament field from 16 teams to 8 teams
#DayNum=145 or 146 (Sat/Sun) - Round 4, otherwise known as "Elite Eight" or "regional finals", to bring the tournament field from 8 teams to 4 teams
#DayNum=152 (Sat) - Round 5, otherwise known as "Final Four" or "national semifinals", to bring the tournament field from 4 teams to 2 teams
#DayNum=154 (Mon) - Round 6, otherwise known as "national final" or "national championship", to bring the tournament field from 2 teams to 1 champion team

NCAATourneyCompactResults=read.csv("DataFiles/NCAATourneyCompactResults.csv")

#WFGM - field goals made (by the winning team)
#WFGA - field goals attempted (by the winning team)
#WFGM3 - three pointers made (by the winning team)
#WFGA3 - three pointers attempted (by the winning team)
#WFTM - free throws made (by the winning team)
#WFTA - free throws attempted (by the winning team)
#WOR - offensive rebounds (pulled by the winning team)
#WDR - defensive rebounds (pulled by the winning team)
#WAst - assists (by the winning team)
#WTO - turnovers committed (by the winning team)
#WStl - steals (accomplished by the winning team)
#WBlk - blocks (accomplished by the winning team)
#WPF - personal fouls committed (by the winning team)
RegularSeasonDetailedResults=read.csv("DataFiles/RegularSeasonDetailedResults.csv")

NCAATourneyDetailedResults=read.csv("DataFiles/NCAATourneyDetailedResults.csv")

Cities=read.csv("DataFiles/Cities.csv")

GameCities=read.csv("DataFiles/GameCities.csv")

MasseyOrdinals=read.csv("MasseyOrdinals.csv")

Events_2010=read.csv("PlayByPlay_2010/Events_2010.csv")
Events_2011=read.csv("PlayByPlay_2011/Events_2011.csv")
Events_2012=read.csv("PlayByPlay_2012/Events_2012.csv")
Events_2013=read.csv("PlayByPlay_2013/Events_2013.csv")
Events_2014=read.csv("PlayByPlay_2014/Events_2014.csv")
Events_2015=read.csv("PlayByPlay_2015/Events_2015.csv")
Events_2016=read.csv("PlayByPlay_2016/Events_2016.csv")
Events_2017=read.csv("PlayByPlay_2017/Events_2017.csv")

Players_2010=read.csv("PlayByPlay_2010/Players_2010.csv")
Players_2011=read.csv("PlayByPlay_2011/Players_2011.csv")
Players_2012=read.csv("PlayByPlay_2012/Players_2012.csv")
Players_2013=read.csv("PlayByPlay_2013/Players_2013.csv")
Players_2014=read.csv("PlayByPlay_2014/Players_2014.csv")
Players_2015=read.csv("PlayByPlay_2015/Players_2015.csv")
Players_2016=read.csv("PlayByPlay_2016/Players_2016.csv")
Players_2017=read.csv("PlayByPlay_2017/Players_2017.csv")
#Delete the "TEAM" from playername column
Players_2010=Players_2010[Players_2010$PlayerName!="TEAM",]
Players_2011=Players_2011[Players_2011$PlayerName!="TEAM",]
Players_2012=Players_2012[Players_2012$PlayerName!="TEAM",]
Players_2013=Players_2013[Players_2013$PlayerName!="TEAM",]
Players_2014=Players_2014[Players_2014$PlayerName!="TEAM",]
Players_2015=Players_2015[Players_2015$PlayerName!="TEAM",]
Players_2016=Players_2016[Players_2016$PlayerName!="TEAM",]
Players_2017=Players_2017[Players_2017$PlayerName!="TEAM",]

TeamCoaches=read.csv("DataFiles/TeamCoaches.csv")

Conferences=read.csv("DataFiles/Conferences.csv")

TeamConferences=read.csv("DataFiles/TeamConferences.csv")

ConferenceTourneyGames=read.csv("DataFiles/ConferenceTourneyGames.csv")

SecondaryTourneyTeams=read.csv("DataFiles/SecondaryTourneyTeams.csv")

SecondaryTourneyCompactResults=read.csv("DataFiles/SecondaryTourneyCompactResults.csv")

```


```{r}
library(dplyr)
library(tidyr)
####get the score of each player every year#### 

##give the score to the player in the following way##
#assist=1
#block=1
#steal=1
#turnover=-1
#timeout, timeout_tv =0
#foul_pers=-1
#foul_tech=-1
#reb_off, reb_def, reb_dead=1
#sub_in, sub_ou=0
#made1_free=1,miss1_free=-1
#made2_dunk=1,miss2_dunk=0
#made2_tip=1,miss2_tip=0
#made2_lay=1,miss2_lay=0
#made2_jump=1,miss2_jump=0
#made3_jump=1,miss3_jump=0

events2010=dplyr::full_join(Events_2010,Players_2010,by=c("Season","EventPlayerID"="PlayerID","EventTeamID"="TeamID"))
events2010$events_score=ifelse(events2010$EventType%in%c("assist","block","steal","reb_off","reb_def","reb_dead","made1_free","made2_dunk","made2_tip","made2_lay","made2_jump","made3_jump"),1,ifelse(events2010$EventType%in%c("turnover","foul_pers","foul_tech","miss1_free"),-1,0))
events2010=group_by(events2010,PlayerName)%>%summarise(TotalScore=sum(events_score))
events2011=dplyr::full_join(Events_2011,Players_2011,by=c("Season","EventPlayerID"="PlayerID","EventTeamID"="TeamID"))
events2011$events_score=ifelse(events2011$EventType%in%c("assist","block","steal","reb_off","reb_def","reb_dead","made1_free","made2_dunk","made2_tip","made2_lay","made2_jump","made3_jump"),1,ifelse(events2011$EventType%in%c("turnover","foul_pers","foul_tech","miss1_free"),-1,0))
events2011=group_by(events2011,PlayerName)%>%summarise(TotalScore=sum(events_score))
events2012=dplyr::full_join(Events_2012,Players_2012,by=c("Season","EventPlayerID"="PlayerID","EventTeamID"="TeamID"))
events2012$events_score=ifelse(events2012$EventType%in%c("assist","block","steal","reb_off","reb_def","reb_dead","made1_free","made2_dunk","made2_tip","made2_lay","made2_jump","made3_jump"),1,ifelse(events2012$EventType%in%c("turnover","foul_pers","foul_tech","miss1_free"),-1,0))
events2012=group_by(events2012,PlayerName)%>%summarise(TotalScore=sum(events_score))
events2013=dplyr::full_join(Events_2013,Players_2013,by=c("Season","EventPlayerID"="PlayerID","EventTeamID"="TeamID"))
events2013$events_score=ifelse(events2013$EventType%in%c("assist","block","steal","reb_off","reb_def","reb_dead","made1_free","made2_dunk","made2_tip","made2_lay","made2_jump","made3_jump"),1,ifelse(events2013$EventType%in%c("turnover","foul_pers","foul_tech","miss1_free"),-1,0))
events2013=group_by(events2013,PlayerName)%>%summarise(TotalScore=sum(events_score))
events2014=dplyr::full_join(Events_2014,Players_2014,by=c("Season","EventPlayerID"="PlayerID","EventTeamID"="TeamID"))
events2014$events_score=ifelse(events2014$EventType%in%c("assist","block","steal","reb_off","reb_def","reb_dead","made1_free","made2_dunk","made2_tip","made2_lay","made2_jump","made3_jump"),1,ifelse(events2014$EventType%in%c("turnover","foul_pers","foul_tech","miss1_free"),-1,0))
events2014=group_by(events2014,PlayerName)%>%summarise(TotalScore=sum(events_score))
events2015=dplyr::full_join(Events_2015,Players_2015,by=c("Season","EventPlayerID"="PlayerID","EventTeamID"="TeamID"))
events2015$events_score=ifelse(events2015$EventType%in%c("assist","block","steal","reb_off","reb_def","reb_dead","made1_free","made2_dunk","made2_tip","made2_lay","made2_jump","made3_jump"),1,ifelse(events2015$EventType%in%c("turnover","foul_pers","foul_tech","miss1_free"),-1,0))
events2015=group_by(events2015,PlayerName)%>%summarise(TotalScore=sum(events_score))
events2016=dplyr::full_join(Events_2016,Players_2016,by=c("Season","EventPlayerID"="PlayerID","EventTeamID"="TeamID"))
events2016$events_score=ifelse(events2016$EventType%in%c("assist","block","steal","reb_off","reb_def","reb_dead","made1_free","made2_dunk","made2_tip","made2_lay","made2_jump","made3_jump"),1,ifelse(events2016$EventType%in%c("turnover","foul_pers","foul_tech","miss1_free"),-1,0))
events2016=group_by(events2016,PlayerName)%>%summarise(TotalScore=sum(events_score))
events2017=dplyr::full_join(Events_2017,Players_2017,by=c("Season","EventPlayerID"="PlayerID","EventTeamID"="TeamID"))
events2017$events_score=ifelse(events2017$EventType%in%c("assist","block","steal","reb_off","reb_def","reb_dead","made1_free","made2_dunk","made2_tip","made2_lay","made2_jump","made3_jump"),1,ifelse(events2017$EventType%in%c("turnover","foul_pers","foul_tech","miss1_free"),-1,0))
events2017=group_by(events2017,PlayerName)%>%summarise(TotalScore=sum(events_score))
```

```{r}
#merge Players file and events 
player_score_2010=dplyr::full_join(Players_2010,events2010,by="PlayerName")
player_score_2011=dplyr::full_join(Players_2011,events2011,by="PlayerName")
player_score_2012=dplyr::full_join(Players_2012,events2012,by="PlayerName")
player_score_2013=dplyr::full_join(Players_2013,events2013,by="PlayerName")
player_score_2014=dplyr::full_join(Players_2014,events2014,by="PlayerName")
player_score_2015=dplyr::full_join(Players_2015,events2015,by="PlayerName")
player_score_2016=dplyr::full_join(Players_2016,events2016,by="PlayerName")
player_score_2017=dplyr::full_join(Players_2017,events2017,by="PlayerName")
```

```{r}
#get the average player score of each team every year 
team_score_2010=group_by(player_score_2010,TeamID)%>%summarise(Teamscore=mean(TotalScore))
team_score_2010$Season=2010
team_score_2010=team_score_2010[-dim(team_score_2010)[1],]
team_score_2011=group_by(player_score_2011,TeamID)%>%summarise(Teamscore=mean(TotalScore))
team_score_2011$Season=2011
team_score_2011=team_score_2011[-dim(team_score_2011)[1],]
team_score_2012=group_by(player_score_2012,TeamID)%>%summarise(Teamscore=mean(TotalScore))
team_score_2012$Season=2012
team_score_2012=team_score_2012[-dim(team_score_2012)[1],]
team_score_2013=group_by(player_score_2013,TeamID)%>%summarise(Teamscore=mean(TotalScore))
team_score_2013$Season=2013
team_score_2013=team_score_2013[-dim(team_score_2013)[1],]
team_score_2014=group_by(player_score_2014,TeamID)%>%summarise(Teamscore=mean(TotalScore))
team_score_2014$Season=2014
team_score_2014=team_score_2014[-dim(team_score_2014)[1],]
team_score_2015=group_by(player_score_2015,TeamID)%>%summarise(Teamscore=mean(TotalScore))
team_score_2015$Season=2015
team_score_2015=team_score_2015[-dim(team_score_2015)[1],]
team_score_2016=group_by(player_score_2016,TeamID)%>%summarise(Teamscore=mean(TotalScore))
team_score_2016$Season=2016
team_score_2016=team_score_2016[-dim(team_score_2016)[1],]
team_score_2017=group_by(player_score_2017,TeamID)%>%summarise(Teamscore=mean(TotalScore))
team_score_2017$Season=2017
team_score_2017=team_score_2017[-dim(team_score_2017)[1],]

team_score=rbind(team_score_2010,team_score_2011)
team_score=rbind(team_score,team_score_2012)
team_score=rbind(team_score,team_score_2013)
team_score=rbind(team_score,team_score_2014)
team_score=rbind(team_score,team_score_2015)
team_score=rbind(team_score,team_score_2016)
team_score=rbind(team_score,team_score_2017)
```

```{r}
####This dataset includes all the variables sampled every year####
dat_year=dplyr::full_join(TeamCoaches,TeamConferences,by=c("Season","TeamID"))
dat_year=dplyr::full_join(dat_year,team_score,by=c("Season","TeamID"))
dat_year
```


```{r}
####This dataset includes all the variables sampled every match####
Compact=rbind(RegularSeasonCompactResults,NCAATourneyCompactResults)
Compact=rbind(Compact,SecondaryTourneyCompactResults[,-dim(SecondaryTourneyCompactResults)[2]])
Details=rbind(RegularSeasonDetailedResults,NCAATourneyDetailedResults)
#I uesd left full because I want to keep the all row in both dataset
Results=dplyr::full_join(Compact,Details,by=c("Season","DayNum","WTeamID","LTeamID","WScore","LScore","WLoc","NumOT"))
dat_day=dplyr::full_join(Results,GameCities,by=c("Season","DayNum","WTeamID","LTeamID"))
spread_rank=spread(MasseyOrdinals,key="SystemName",value="OrdinalRank")
dat_day=left_join(dat_day,spread_rank,by=c("Season","DayNum"="RankingDayNum","WTeamID"="TeamID"))
dat_day=left_join(dat_day,spread_rank,by=c("Season","DayNum"="RankingDayNum","LTeamID"="TeamID"))
#70T.x~ZAM.x is the ranking for WTeam
#70T.y~ZAM.y is the ranking for LTeam
colnames(dat_day)
dat_day
```




